<UserControl x:Class="UniAcamanageWpfApp.Views.CourseSelectionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="950"
             d:DesignWidth="1200"
             MinHeight="700"
             MinWidth="800"
             DataContext="{Binding RelativeSource={RelativeSource Self}, Path=DataContext}">

    <UserControl.Resources>
        <!-- 颜色定义 -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#3A76D2"/>
        <SolidColorBrush x:Key="SecondaryBrush" Color="#2B5CA6"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#007ACC"/>

        <!-- Tab样式 -->
        <Style x:Key="CustomTabStyle" TargetType="TabItem" BasedOn="{StaticResource MaterialDesignNavigationRailTabItem}">
            <Setter Property="Width" Value="180"/>
            <Setter Property="Height" Value="80"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Foreground" Value="#666666"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                    <Setter Property="Background" Value="#F5F9FF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 卡片渐变动画 -->
        <Storyboard x:Key="FadeInStoryboard">
            <DoubleAnimation 
         Storyboard.TargetName="MainGrid"
         Storyboard.TargetProperty="Opacity"
         From="0" To="1" 
         Duration="0:0:0.3"/>
        </Storyboard>

        <!-- 按钮样式 -->
        <Style TargetType="Button" x:Key="AnimatedButtonStyle" 
        BasedOn="{StaticResource MaterialDesignRaisedButton}">
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Height" Value="45"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="materialDesign:ButtonAssist.CornerRadius" Value="8"/>
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation 
                             Storyboard.TargetProperty="(Button.RenderTransform).(ScaleTransform.ScaleX)"
                             To="1.05" Duration="0:0:0.1"/>
                                <DoubleAnimation 
                             Storyboard.TargetProperty="(Button.RenderTransform).(ScaleTransform.ScaleY)"
                             To="1.05" Duration="0:0:0.1"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation 
                             Storyboard.TargetProperty="(Button.RenderTransform).(ScaleTransform.ScaleX)"
                             To="1" Duration="0:0:0.1"/>
                                <DoubleAnimation 
                             Storyboard.TargetProperty="(Button.RenderTransform).(ScaleTransform.ScaleY)"
                             To="1" Duration="0:0:0.1"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- DataGrid样式 -->
        <Style x:Key="CommonDataGridStyle" TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#DDDDDD"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="RowHeight" Value="50"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <!-- 添加以下滚动设置 -->
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
            <Setter Property="VirtualizingPanel.IsVirtualizing" Value="True"/>
            <Setter Property="VirtualizingPanel.VirtualizationMode" Value="Recycling"/>
            <Setter Property="MaxHeight" Value="600"/>
        </Style>

        <!-- ComboBox样式 -->
        <Style x:Key="CommonComboBoxStyle" TargetType="ComboBox" BasedOn="{StaticResource MaterialDesignOutlinedComboBox}">
            <Setter Property="Height" Value="56"/>
            <Setter Property="Padding" Value="12,8,12,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="materialDesign:TextFieldAssist.TextFieldCornerRadius" Value="4"/>
            <Setter Property="materialDesign:TextFieldAssist.UnderlineBrush" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="materialDesign:HintAssist.FloatingScale" Value="0.85"/>
            <Setter Property="materialDesign:HintAssist.FloatingOffset" Value="0,-18"/>
        </Style>

        <!-- 搜索框样式 -->
        <Style x:Key="SearchBoxStyle" TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="56"/>
            <Setter Property="Padding" Value="12,8,12,0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="materialDesign:TextFieldAssist.TextFieldCornerRadius" Value="4"/>
            <Setter Property="materialDesign:TextFieldAssist.UnderlineBrush" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="materialDesign:HintAssist.Foreground" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="materialDesign:HintAssist.FloatingScale" Value="0.85"/>
            <Setter Property="materialDesign:HintAssist.FloatingOffset" Value="0,-18"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="Background" Value="White"/>
        </Style>
    </UserControl.Resources>

    <Grid x:Name="MainGrid" Margin="20">
        <!-- 加载指示器 -->
        <materialDesign:Card x:Name="LoadingIndicator" 
                        Visibility="Collapsed"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Panel.ZIndex="1000">
            <StackPanel Margin="16">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                        Value="0"
                        IsIndeterminate="True" />
                <TextBlock Text="正在加载..."
                      HorizontalAlignment="Center"
                      Margin="0,8,0,0"/>
            </StackPanel>
        </materialDesign:Card>

        <TabControl Style="{StaticResource MaterialDesignTabControl}"
                    TabStripPlacement="Top"
                    Background="Transparent"
                    BorderThickness="0"
                    Margin="0,10,0,0">

            <!-- 1. 推荐选课 Tab -->
            <TabItem Style="{StaticResource CustomTabStyle}">
                <TabItem.Header>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="StarCircle" 
                                 Width="24" Height="24"
                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="推荐选课" 
                   TextAlignment="Center"
                   Margin="0,5,0,0"/>
                    </StackPanel>
                </TabItem.Header>

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <materialDesign:Card Margin="10" 
                               Padding="30"
                               Background="White"
                               materialDesign:ElevationAssist.Elevation="Dp1"
                               UniformCornerRadius="15">
                            <StackPanel>
                                <!-- 标题和培养方案信息 -->
                                <DockPanel LastChildFill="False" Margin="0,0,0,20">
                                    <StackPanel DockPanel.Dock="Left">
                                        <TextBlock Text="课程推荐" 
                                     FontSize="28" 
                                     FontWeight="Bold"
                                     Foreground="#333333"/>
                                        <TextBlock Text="基于您的专业培养方案为您推荐以下课程"
                                     FontSize="14"
                                     Foreground="#666666"
                                     Margin="0,5,0,0"/>
                                    </StackPanel>

                                    <!-- 右上角显示专业和学期信息 -->
                                    <StackPanel DockPanel.Dock="Right" 
                                  HorizontalAlignment="Right">
                                        <TextBlock Text="{Binding CurrentMajor}"
                                     FontSize="16"
                                     Foreground="#666666"/>
                                        <ComboBox x:Name="RecommendSemesterComboBox"
                                    Style="{StaticResource CommonComboBoxStyle}"
                                    materialDesign:HintAssist.Hint="选择学期"
                                    Width="200"
                                    Margin="0,10,0,0"/>
                                    </StackPanel>
                                </DockPanel>

                                <!-- 1. 基础必修课程区块 -->
                                <Expander Margin="0,0,0,20"
                             IsExpanded="True"
                             Background="#F5F9FF">
                                    <Expander.Header>
                                        <DockPanel LastChildFill="False">
                                            <TextBlock Text="基础必修课程" 
                                         FontSize="18" 
                                         FontWeight="SemiBold"
                                         Foreground="#333333"/>
                                            <TextBlock Text="{Binding BasicRequiredCount, StringFormat='待选课程：{0}门'}"
                                         FontSize="14"
                                         Foreground="#666666"
                                         Margin="20,0,0,0"/>
                                        </DockPanel>
                                    </Expander.Header>

                                    <DataGrid x:Name="BasicRequiredGrid"
                                Style="{StaticResource CommonDataGridStyle}"
                                MaxHeight="300"
                                Margin="0,10">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Width="60">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource MaterialDesignCheckBox}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <DataGridTextColumn Header="课程代码" Binding="{Binding CourseCode}" Width="100"/>
                                            <DataGridTextColumn Header="课程名称" Binding="{Binding CourseName}" Width="200"/>
                                            <DataGridTextColumn Header="学分" Binding="{Binding Credit}" Width="60"/>
                                            <DataGridTextColumn Header="上课时间" Binding="{Binding ScheduleTime}" Width="150"/>
                                            <DataGridTextColumn Header="教室" Binding="{Binding Classroom}" Width="100"/>
                                            <DataGridTextColumn Header="任课教师" Binding="{Binding TeacherName}" Width="100"/>
                                            <DataGridTextColumn Header="已选/容量" Binding="{Binding Capacity}" Width="100"/>
                                            <DataGridTextColumn Header="课程说明" Binding="{Binding Description}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Expander>

                                <!-- 2. 专业必修课程区块 -->
                                <Expander Margin="0,0,0,20"
                             IsExpanded="True"
                             Background="#F5F9FF">
                                    <Expander.Header>
                                        <DockPanel LastChildFill="False">
                                            <TextBlock Text="专业必修课程" 
                                         FontSize="18" 
                                         FontWeight="SemiBold"
                                         Foreground="#333333"/>
                                            <TextBlock Text="{Binding MajorRequiredCount, StringFormat='待选课程：{0}门'}"
                                         FontSize="14"
                                         Foreground="#666666"
                                         Margin="20,0,0,0"/>
                                        </DockPanel>
                                    </Expander.Header>

                                    <DataGrid x:Name="MajorRequiredGrid"
                                Style="{StaticResource CommonDataGridStyle}"
                                MaxHeight="300"
                                Margin="0,10">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Width="60">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource MaterialDesignCheckBox}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!-- 相同的列定义 -->
                                            <DataGridTextColumn Header="课程代码" Binding="{Binding CourseCode}" Width="100"/>
                                            <DataGridTextColumn Header="课程名称" Binding="{Binding CourseName}" Width="200"/>
                                            <DataGridTextColumn Header="学分" Binding="{Binding Credit}" Width="60"/>
                                            <DataGridTextColumn Header="上课时间" Binding="{Binding ScheduleTime}" Width="150"/>
                                            <DataGridTextColumn Header="教室" Binding="{Binding Classroom}" Width="100"/>
                                            <DataGridTextColumn Header="任课教师" Binding="{Binding TeacherName}" Width="100"/>
                                            <DataGridTextColumn Header="已选/容量" Binding="{Binding Capacity}" Width="100"/>
                                            <DataGridTextColumn Header="课程说明" Binding="{Binding Description}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Expander>

                                <!-- 3. 选修课程区块 -->
                                <Expander Margin="0,0,0,20"
                             IsExpanded="True"
                             Background="#F5F9FF">
                                    <Expander.Header>
                                        <DockPanel LastChildFill="False">
                                            <TextBlock Text="推荐选修课程" 
                                         FontSize="18" 
                                         FontWeight="SemiBold"
                                         Foreground="#333333"/>
                                            <TextBlock Text="{Binding ElectiveCount, StringFormat='推荐课程：{0}门'}"
                                         FontSize="14"
                                         Foreground="#666666"
                                         Margin="20,0,0,0"/>
                                        </DockPanel>
                                    </Expander.Header>

                                    <DataGrid x:Name="ElectiveGrid"
                                Style="{StaticResource CommonDataGridStyle}"
                                MaxHeight="300"
                                Margin="0,10">
                                        <DataGrid.Columns>
                                            <DataGridTemplateColumn Width="60">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsChecked="{Binding IsSelected, UpdateSourceTrigger=PropertyChanged}"
                                                    Style="{StaticResource MaterialDesignCheckBox}"/>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!-- 相同的列定义 -->
                                            <DataGridTextColumn Header="课程代码" Binding="{Binding CourseCode}" Width="100"/>
                                            <DataGridTextColumn Header="课程名称" Binding="{Binding CourseName}" Width="200"/>
                                            <DataGridTextColumn Header="学分" Binding="{Binding Credit}" Width="60"/>
                                            <DataGridTextColumn Header="上课时间" Binding="{Binding ScheduleTime}" Width="150"/>
                                            <DataGridTextColumn Header="教室" Binding="{Binding Classroom}" Width="100"/>
                                            <DataGridTextColumn Header="任课教师" Binding="{Binding TeacherName}" Width="100"/>
                                            <DataGridTextColumn Header="已选/容量" Binding="{Binding Capacity}" Width="100"/>
                                            <DataGridTextColumn Header="课程说明" Binding="{Binding Description}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Expander>

                                <!-- 底部操作按钮和统计信息 -->
                                <Grid Margin="0,20,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 左侧统计信息 -->
                                    <StackPanel Grid.Column="0" 
            Orientation="Horizontal">
                                        <TextBlock Text="已选课程： "/>
                                        <TextBlock x:Name="TotalCoursesText"
               Text="{Binding SelectedCourseCount}"
               FontWeight="Bold"
               Foreground="{StaticResource PrimaryBrush}"/>
                                        <TextBlock Text=" 门  总学分： "
               Margin="10,0"/>
                                        <TextBlock x:Name="TotalCreditsText"
               Text="{Binding TotalCredits}"
               FontWeight="Bold"
               Foreground="{StaticResource PrimaryBrush}"/>
                                    </StackPanel>

                                    <!-- 右侧按钮 -->
                                    <StackPanel Grid.Column="2" 
                                  Orientation="Horizontal"
                                  HorizontalAlignment="Right">
                                        <Button Content="预览课表"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Margin="0,0,20,0"
                                    Click="PreviewSchedule_Click"/>
                                        <Button Content="提交选课"
                                    Style="{StaticResource AnimatedButtonStyle}"
                                    Click="SubmitSelection_Click"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </materialDesign:Card>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- 2. 自主选课 Tab -->
            <TabItem Style="{StaticResource CustomTabStyle}">
                <TabItem.Header>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="BookPlus" 
                                 Width="24" Height="24"
                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="自主选课" 
                   TextAlignment="Center"
                   Margin="0,5,0,0"/>
                    </StackPanel>
                </TabItem.Header>

                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <materialDesign:Card Margin="10" 
                               Padding="30"
                               Background="White"
                               materialDesign:ElevationAssist.Elevation="Dp1"
                               UniformCornerRadius="15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- 顶部搜索和筛选区域 -->
                                <Grid Grid.Row="0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- 标题和学期选择 -->
                                    <DockPanel Grid.Row="0" 
                                 LastChildFill="False" 
                                 Margin="0,0,0,20">
                                        <StackPanel DockPanel.Dock="Left">
                                            <TextBlock Text="自主选课" 
                                         FontSize="28" 
                                         FontWeight="Bold"
                                         Foreground="#333333"/>
                                            <TextBlock Text="搜索并选择您感兴趣的课程"
                                         FontSize="14"
                                         Foreground="#666666"
                                         Margin="0,5,0,0"/>
                                        </StackPanel>

                                        <ComboBox DockPanel.Dock="Right"
                                    x:Name="SelfSelectSemesterComboBox"
                                    Style="{StaticResource CommonComboBoxStyle}"
                                    materialDesign:HintAssist.Hint="选择学期"
                                    Width="200"/>
                                    </DockPanel>

                                    <!-- 搜索和筛选条件 -->
                                    <Grid Grid.Row="1" Margin="0,0,0,20">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- 搜索框 -->
                                        <TextBox Grid.Column="0"
                                    x:Name="CourseSearchBox"
                                    Style="{StaticResource SearchBoxStyle}"
                                    materialDesign:HintAssist.Hint="输入课程名称、课程代码或教师姓名"
                                    Margin="0,0,10,0"
                                    TextChanged="CourseSearchBox_TextChanged"/>

                                        <!-- 课程类型筛选 -->
                                        <ComboBox Grid.Column="1"
          x:Name="CourseTypeFilter"
          Style="{StaticResource CommonComboBoxStyle}"
          materialDesign:HintAssist.Hint="课程类型"
          Margin="10,0"
          SelectionChanged="FilterCourses_SelectionChanged">
                                            <ComboBoxItem Content="全部类型"/>
                                            <ComboBoxItem Content="基础必修"/>
                                            <ComboBoxItem Content="专业必修"/>
                                            <ComboBoxItem Content="选修课程"/>
                                        </ComboBox>

                                        <!-- 上课时间筛选 -->
                                        <ComboBox Grid.Column="2"
          x:Name="TimeSlotFilter"
          Style="{StaticResource CommonComboBoxStyle}"
          materialDesign:HintAssist.Hint="上课时间"
          Margin="10,0"
          SelectionChanged="FilterCourses_SelectionChanged">
                                            <ComboBoxItem Content="全部时间"/>
                                            <ComboBoxItem Content="上午课程"/>
                                            <ComboBoxItem Content="下午课程"/>
                                            <ComboBoxItem Content="晚上课程"/>
                                        </ComboBox>

                                        <!-- 课程状态筛选 -->
                                        <ComboBox Grid.Column="3"
                                    x:Name="CourseStatusFilter"
                                    Style="{StaticResource CommonComboBoxStyle}"
                                    materialDesign:HintAssist.Hint="课程状态"
                                    Margin="10,0">
                                            <ComboBoxItem Content="全部课程"/>
                                            <ComboBoxItem Content="有余量"/>
                                            <ComboBoxItem Content="已满额"/>
                                        </ComboBox>

                                        <Button Grid.Column="4"
        Content="搜索"
        Style="{StaticResource AnimatedButtonStyle}"
        Margin="10,0,0,0"
        Width="100"
        x:Name="SearchCoursesButton"
        Click="SearchCourses_Click"/>
                                    </Grid>
                                </Grid>

                                <!-- 课程列表和选课区域 -->
                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="2*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 左侧课程列表 -->
                                    <materialDesign:Card Grid.Column="0"
                                           Margin="0,0,10,0"
                                           Background="White"
                                           materialDesign:ElevationAssist.Elevation="Dp1"
                                           UniformCornerRadius="8">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>

                                            <DockPanel Grid.Row="0" 
           LastChildFill="False"
           Margin="15,15,15,5">
                                                <TextBlock Text="可选课程列表" 
               FontSize="16"
               FontWeight="SemiBold"
               DockPanel.Dock="Left"/>
                                                <TextBlock x:Name="AvailableCourseCountText"
               Text="{Binding AvailableCourseCount, StringFormat='共找到 {0} 门课程'}"
               Foreground="#666666"
               DockPanel.Dock="Right"/>
                                            </DockPanel>

                                            <!-- 课程列表 -->
                                            <DataGrid Grid.Row="1"
                                        x:Name="AvailableCoursesGrid"
                                        Style="{StaticResource CommonDataGridStyle}"
                                        Margin="0,5,0,0">
                                                <DataGrid.Columns>
                                                    <DataGridTemplateColumn Width="60">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Button Style="{StaticResource MaterialDesignIconButton}"
                                                            Click="AddCourse_Click"
                                                            Margin="0,0,4,0"
                                                            Height="35"
                                                            Width="35">
                                                                    <materialDesign:PackIcon Kind="Plus"/>
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTextColumn Header="课程代码" Binding="{Binding CourseCode}" Width="100"/>
                                                    <DataGridTextColumn Header="课程名称" Binding="{Binding CourseName}" Width="200"/>
                                                    <DataGridTextColumn Header="课程类型" Binding="{Binding CourseType}" Width="100"/>
                                                    <DataGridTextColumn Header="学分" Binding="{Binding Credit}" Width="60"/>
                                                    <DataGridTextColumn Header="上课时间" Binding="{Binding ScheduleTime}" Width="150"/>
                                                    <DataGridTextColumn Header="教室" Binding="{Binding Classroom}" Width="100"/>
                                                    <DataGridTextColumn Header="教师" Binding="{Binding TeacherName}" Width="100"/>
                                                    <DataGridTextColumn Header="已选/容量" Binding="{Binding Capacity}" Width="100"/>
                                                </DataGrid.Columns>
                                            </DataGrid>
                                        </Grid>
                                    </materialDesign:Card>

                                    <!-- 右侧已选课程 -->
                                    <materialDesign:Card Grid.Column="1"
                                           Margin="10,0,0,0"
                                           Background="White"
                                           materialDesign:ElevationAssist.Elevation="Dp1"
                                           UniformCornerRadius="8">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- 已选课程标题 -->
                                            <DockPanel Grid.Row="0"
                                         LastChildFill="False"
                                         Margin="15,15,15,5">
                                                <TextBlock Text="已选课程" 
                                             FontSize="16"
                                             FontWeight="SemiBold"
                                             DockPanel.Dock="Left"/>
                                                <TextBlock Text="{Binding SelectedCourseCount, StringFormat='已选 {0} 门'}"
                                             Foreground="#666666"
                                             DockPanel.Dock="Right"/>
                                            </DockPanel>

                                            <!-- 已选课程列表 -->
                                            <DataGrid Grid.Row="1"
                                        x:Name="SelectedCoursesGrid"
                                        ItemsSource="{Binding SelectedCourses}"
                                        Style="{StaticResource CommonDataGridStyle}"
                                        Margin="0,5,0,0">
                                                <DataGrid.Columns>
                                                    <DataGridTemplateColumn Width="60">
                                                        <DataGridTemplateColumn.CellTemplate>
                                                            <DataTemplate>
                                                                <Button Style="{StaticResource MaterialDesignIconButton}"
                                                            Click="RemoveCourse_Click"
                                                            Margin="0,0,4,0"
                                                            Height="35"
                                                            Width="35">
                                                                    <materialDesign:PackIcon Kind="Minus"/>
                                                                </Button>
                                                            </DataTemplate>
                                                        </DataGridTemplateColumn.CellTemplate>
                                                    </DataGridTemplateColumn>
                                                    <DataGridTextColumn Header="课程代码" Binding="{Binding CourseCode}" Width="100"/>
                                                    <DataGridTextColumn Header="课程名称" Binding="{Binding CourseName}" Width="*"/>
                                                    <DataGridTextColumn Header="学分" Binding="{Binding Credit}" Width="60"/>
                                                </DataGrid.Columns>
                                            </DataGrid>

                                            <!-- 底部统计和操作 -->
                                            <StackPanel Grid.Row="2"
                                          Margin="15">
                                                <!-- 统计信息 -->
                                                <DockPanel Margin="0,0,0,10">
                                                    <TextBlock Text="总学分：" 
                                                 VerticalAlignment="Center"/>
                                                    <TextBlock Text="{Binding TotalCredits}"
                                                 FontWeight="Bold"
                                                 Foreground="{StaticResource PrimaryBrush}"
                                                 VerticalAlignment="Center"/>
                                                </DockPanel>

                                                <!-- 操作按钮 -->
                                                <StackPanel Orientation="Horizontal"
                                              HorizontalAlignment="Right">
                                                    <Button Content="预览课表"
                                                Style="{StaticResource MaterialDesignOutlinedButton}"
                                                Margin="0,0,10,0"
                                                Click="PreviewSchedule_Click"/>
                                                    <Button Content="提交选课"
                                                Style="{StaticResource AnimatedButtonStyle}"
                                                Click="SubmitSelection_Click"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </materialDesign:Card>
                                </Grid>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- 修改后的第三个Tab -->
            <TabItem Style="{StaticResource CustomTabStyle}">
                <TabItem.Header>
                    <StackPanel>
                        <materialDesign:PackIcon Kind="ClipboardList" 
                                 Width="24" Height="24"
                                 HorizontalAlignment="Center"/>
                        <TextBlock Text="选课结果" 
                   TextAlignment="Center"
                   Margin="0,5,0,0"/>
                    </StackPanel>
                </TabItem.Header>

                <!-- 选课结果内容 -->
                <Grid Margin="20">
                    <materialDesign:Card Margin="10" 
                           Padding="30"
                           Background="White"
                           materialDesign:ElevationAssist.Elevation="Dp1"
                           UniformCornerRadius="15">
                        <StackPanel Margin="0,-20,0,0">
                            <!-- 标题 -->
                            <DockPanel LastChildFill="False" Margin="0,0,0,30">
                                <TextBlock Text="选课结果确认" 
                             FontSize="28" 
                             FontWeight="Bold"
                             Foreground="#333333"
                             DockPanel.Dock="Left"/>
                                <TextBlock Text="{Binding QueryTime, StringFormat=更新时间：{0:yyyy-MM-dd HH:mm:ss}}"
                             FontSize="14"
                             Foreground="#757575"
                             DockPanel.Dock="Right"
                             VerticalAlignment="Bottom"/>
                            </DockPanel>

                            <!-- 学期选择 -->
                            <Grid Width="400" 
                      HorizontalAlignment="Center" 
                      Margin="0,0,0,30">
                                <StackPanel>
                                    <TextBlock Text="选择学期："
                                 FontSize="16"
                                 FontWeight="SemiBold"
                                 Margin="0,0,0,10"
                                 Foreground="#666666"/>
                                    <ComboBox x:Name="SelectionSemesterComboBox"
                                Style="{StaticResource CommonComboBoxStyle}"
                                materialDesign:HintAssist.Hint="请选择要查看的学期"
                                Height="56"
                                Margin="0,0,0,20"/>
                                </StackPanel>
                            </Grid>

                            <!-- 选课结果列表 -->
                            <materialDesign:Card Background="White"
                                   materialDesign:ElevationAssist.Elevation="Dp1"
                                   UniformCornerRadius="8"
                                   Margin="0,10">
                                <DataGrid x:Name="CourseSelectionResultGrid"
                                          ItemsSource="{Binding CourseSelectionResults}"
                                          Style="{StaticResource CommonDataGridStyle}"
                                          Height="189">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="课程代码" Binding="{Binding CourseCode}" Width="100"/>
                                        <DataGridTextColumn Header="课程名称" Binding="{Binding CourseName}" Width="200"/>
                                        <DataGridTextColumn Header="课程类型" Binding="{Binding CourseType}" Width="100"/>
                                        <DataGridTextColumn Header="学分" Binding="{Binding Credit}" Width="60"/>
                                        <DataGridTextColumn Header="上课时间" Binding="{Binding ScheduleTime}" Width="150"/>
                                        <DataGridTextColumn Header="教室" Binding="{Binding Classroom}" Width="100"/>
                                        <DataGridTextColumn Header="任课教师" Binding="{Binding TeacherName}" Width="100"/>
                                        <DataGridTextColumn Header="审核状态" Binding="{Binding ApprovalStatus}" Width="100">
                                            <DataGridTextColumn.CellStyle>
                                                <Style TargetType="DataGridCell">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding ApprovalStatus}" Value="已确认">
                                                            <Setter Property="Foreground" Value="#4CAF50"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding ApprovalStatus}" Value="待审核">
                                                            <Setter Property="Foreground" Value="#FF9800"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding ApprovalStatus}" Value="未通过">
                                                            <Setter Property="Foreground" Value="#F44336"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </DataGridTextColumn.CellStyle>
                                        </DataGridTextColumn>
                                        <DataGridTextColumn Header="未通过原因" Binding="{Binding RejectReason}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </materialDesign:Card>


                            <!-- 统计信息 -->
                            <Grid Margin="0,20,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <materialDesign:Card Grid.Column="0" 
                                       Margin="5"
                                       Padding="15"
                                       Background="#F5F9FF">
                                    <StackPanel>
                                        <TextBlock Text="已选课程数"
                                     FontSize="14"
                                     Foreground="#666666"/>
                                        <TextBlock Text="{Binding TotalSelectedCourses}"
                                     FontSize="24"
                                     FontWeight="Bold"
                                     Foreground="{StaticResource PrimaryBrush}"
                                     Margin="0,5,0,0"/>
                                    </StackPanel>
                                </materialDesign:Card>

                                <materialDesign:Card Grid.Column="1" 
                                       Margin="5"
                                       Padding="15"
                                       Background="#F5F9FF">
                                    <StackPanel>
                                        <TextBlock Text="总学分"
                                     FontSize="14"
                                     Foreground="#666666"/>
                                        <TextBlock Text="{Binding TotalCredits}"
                                     FontSize="24"
                                     FontWeight="Bold"
                                     Foreground="{StaticResource PrimaryBrush}"
                                     Margin="0,5,0,0"/>
                                    </StackPanel>
                                </materialDesign:Card>

                                <materialDesign:Card Grid.Column="2" 
                                       Margin="5"
                                       Padding="15"
                                       Background="#F5F9FF">
                                    <StackPanel>
                                        <TextBlock Text="审核通过率"
                                     FontSize="14"
                                     Foreground="#666666"/>
                                        <TextBlock Text="{Binding ApprovalRate, StringFormat={}{0}%}"
                                     FontSize="24"
                                     FontWeight="Bold"
                                     Foreground="{StaticResource PrimaryBrush}"
                                     Margin="0,5,0,0"/>
                                    </StackPanel>
                                </materialDesign:Card>
                            </Grid>
                        </StackPanel>
                    </materialDesign:Card>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>